
<!DOCTYPE html>
<!--
   main.html
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
	
   
   Copyright 2013 Paul Cuzner <paul.cuzner@redhat.com>
   
   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.
   
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
   MA 02110-1301, USA.
   
   browser dependencies
   * autofocus is html5, needs ie10 or above, or firefox, safari, chrome, opera to work
   * input type of number requires html5 support
     
-->


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>Gluster Setup</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	
	<link rel="stylesheet" type="text/css" href="css/theme.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<link rel="stylesheet" type="text/css" href="css/switch.css">	

	<script src="js/config.js"></script>
	<script src="js/layoutMgmt.js"></script>
	<script src="js/loginPage.js"></script>
	<script src="js/nodeDiscovery.js"></script>
	<script src="js/keyMgmt.js"></script>
	<script src="js/diskDiscovery.js"></script>
	<script src="js/brickDefinition.js"></script>
	<script src="js/ajaxHandler.js"></script>
	<script src="js/volCreate.js"></script>
	<script src="js/pageLoad.js"></script>
	
</head>

<body>
<h1>Gluster Configuration and Setup</h1>

<div id="steps" >
		<ul style="list-style:none; padding:0px;">
			<li id="m-overview" class="pending">Overview</li>
			<li id="m-nodes" class="pending">Node Discovery</li>
			<li id="m-keys" class="pending">SSH Keys</li>
			<li id="m-disks" class="pending">Disk Discovery</li>
			<li id="m-bricks" class="pending">Brick Definition</li>
			<li id="m-volCreate" class="pending">Create Volume</li>			
			<li id="m-finish" class="pending">Finish</li>		
		</ul>
</div>


<div id="access">
	<span id="inputData">
		<b>Enter Key</b> 
		<input type="text" id="password" size="26" maxlength="26" autofocus>
		<button id="checkKey" type="button" onclick="validateKey()">Next</button>
	</span>
</div>

<div id="busy" >
	<div id="busyGraphic"  class="spinner"></div>
	<span id="busyMsg" ></span>
	<div id="busyLog"></div>
	<button id="busyButton" type="button" disabled >Next</button>

</div>

<div id="container" >
	
	<div id="logo" ></div> 
	<div id="overview"><h2>Overview</h2>
	<p>
	Once the glusterfs packages are installed, you need to configure the gluster environment
	before any volumes can be presented to 'clients'. This tools enables you to quickly setup a 
	gluster cluster, by moving through several configuration phases;</p>
	<p><li><b>Node discovery :</b> scan a subnet to identify candidate nodes to build a cluster from</li></p>
	<p><li><b>SSH keys :</b> push ssh keys out to the cluster nodes to enable remote scripts to be run</li></p>
	<p><li><b>Disk discovery :</b> select which disks on the nodes are to be used as gluster 'bricks'</li></p>
	<p><li><b>Brick definition :</b> execution of scripts across nodes to create bricks in a standard manner</li></p>
	<p><li><b>Volume creation :</b> create and optimise a volume for a specific use case</li></p>
	<p>
	Once this process is complete you will have a fully functioning gluster environment, with the first volume
	created and available for client connections.
	</p>
	<button id="overviewNext" type="button" disabled onclick='startNodesPage()' class="nextButton">Next</button>
	</div>
	
	<div id="nodes"><h2>Node Discovery</h2>
		<div id="nodesProvided">
		  <p>The nodes shown below are provided by the configuration file supplied when gluster-deploy was invoked.</p>
		</div>
		<div id="nodeScanning">
			<p>Subnet to scan&nbsp;
			<select id="network-select">
			</select>
			<button id="network-scan-btn" type="button" disabled onclick="scanSubnet()"><i class="icon-search"></i>Scan</button>
			</p>
		</div>

	  <div id="nodeSelect">
		<select id="candidateNodes" onchange="enableButton('addNodes')" multiple size=28>
		</select>
		<button id="addNodes" type="button" disabled onclick="promoteNodes()"><i class="icon-right-big"></i></button>
		<select id="selectedNodes"  multiple size=28>
		</select>
		<button id="createCluster" type="button" disabled onclick="createCluster()">Create</button>
	  </div>
	</div>
	
	<div id="keys"><h2>SSH Keys</h2>
		<p>SSH keys are available on this host to push to the nodes in the cluster. Once the public key
		has been distributed, disks on the nodes can be discovered and formatted as gluster bricks.</p>
		<input type="radio" name="passwordMethod" value="generic" checked="checked" onclick="togglePassword('generic');">Use a generic password for all hosts/nodes&nbsp;
		  <span >
			  <input type="text" id="genericPassword" size="26" maxlength="26" >
		  </span><br>
		<input type="radio" name="passwordMethod" value="unique" onclick="togglePassword('unique');">Each node has a unique password&nbsp;<br>
		<br>
		<button id="pushKeys" type="button" onclick="pushKeys()"><i class="icon-keys"></i>Distribute</button>
		<table id="keysHeading" cellspacing='0'>
			<thead>
				<tr>
					<th>Server Name</th>
					<th>Password</th>
				</tr>
			</thead>
		</table>		
		<div id="keysArea">	
			<table id="keysTable" cellspacing='0'>
				<tbody>
				</tbody>
			</table>
		</div>

		
	</div>
	
	<div id="disks"><h2>Disk Discovery</h2>
		<p>With the ssh keys in place, the nodes can now be scanned to collect a list of 'unclaimed' disks to be used as gluster bricks<br>
		</p>
		<button id="getDisks" type="button" onclick="findDisks()"><i class="icon-search"></i>Find Disks</button>
		<div id="diskArea">
			<table id="diskTable" cellspacing='0'>
				<thead>
					<tr>
						<th>Server Name</th>
						<th>Device</th>
						<th>Capacity<br>(GB)</th>
						<th>Select<br>
							<input type='checkbox' id='allDisks' onclick="selectAll();" />
						</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
				<button id="registerBricks" class="registerButton hidden" type="button" onclick="registerBricks()">Next</button>
		</div>

	</div>
	
	<div id="bricks"><h2>Brick Definition</h2>
		<p>Typically each node in the cluster will have an identical configuration to ensure balanced application performance. 
		This configuration page, gathers the metrics that allow bricks to be defined optimally for a given workload. </p>
		<p>Complete the items below, then click on the "Build Bricks" button to start the formatting process.
		</p>
		Use Case
		<select id="useCase">
			<option value="generic" selected="selected">Generic File Serving</option>
			<option value="virtualisation">Virtualisation</option>
			<option value="object">Object Storage</option>
		</select>
		<p>
		Brick Filesystem Provided by&nbsp;
		<select id="brickProvider" onchange="switchProvider(this.value)">
			<option value="LVM" selected="selected">Logical Volume Manager (LVM)</option>
		</select>
		</p>
		<div id="lvm">
			<div id="snapRequired">
				Volume Snapshots&nbsp;
				<label id="snapshotSwitch" class="switch" >
					<input id="snapshotsRequired" type="checkbox" onclick="snapToggle(this.checked)" class="switch-input">
					<span class="switch-label" data-on="On" data-off="Off"></span>
					<span class="switch-handle"></span>
				</label>
				<div id="snapReserve">
					Snapshot Space&nbsp;<span id="snapshotValue" >10%</span>&nbsp;&nbsp;&nbsp;<strong>0</strong>
					<input id="snapshotSpace" oninput="updateSnapshot();" onkeyup="updateSnapshot();" onmouseup="updateSnapshot();" type='range' min="0" max="30" value="10" >
					<span style="position:relative; left:-15px;" ><strong>30</strong></span>
				</div>

			</div>
	
			Volume Group to create&nbsp;  
			<input type='text' id="vgName" class="brickInputField" value="gluster" onkeyup="updateLV();" onchange="validateBrickParms(this);" ></p>
			Logical Volume Name&nbsp;  
			<input type='text' id="lvName" value="gluster"  class="brickInputField" onfocus="validateBrickParms(this)" onchange="validateBrickParms(this);"></p>
		</div>
		<p>Mount point for the brick&nbsp;
		<input type="text" id="mountPoint" class="brickInputField" value="/gluster/brick1" ></p>
		<button id="buildBricks" class="bricksButton" type="button" onclick="buildBricks()"><i class="icon-commit-config"></i>Build Bricks</button>
	</div>
	
	<div id="volCreate"><h2>Create a Volume</h2>
		<p style="position:relative; top:-15px;line-height:2;">
			Volume Name: 
			<input id="volNameInput" type="text" size=26 onkeyup="updateSummary('volume')">
			<br>
			
			Use Case:&nbsp;
			<select id="volUseCase" style="position:relative; left:21px; width:130px;" onchange="addOptions(this.options[this.selectedIndex].value);">
				<option>Generic</option>
				<option>Virtualisation</option>
				<option>Streaming</option>
				<option>Hadoop</option>
			</select>
			<span id="virtInput" style="position:relative;left:40px;opacity:0;transition: opacity .75s;">
				Target environment&nbsp;
				<select id="virtUser" disabled>
					<option>glance</option>
					<option>cinder</option>
					<option>RHEV / oVirt</option>
				</select>
			</span>
			<span id="streamingInput">
			</span>
			<span id="genericInput">
			</span>
			<br>
			Volume Type:&nbsp;
			<select id="volType" onchange="addOptions(this.options[this.selectedIndex].value)" >
				<option>Distributed</option>
				<option>Replicated</option>
			</select>
			<span id="replicaCount" style="opacity:0;transition: opacity .75s;">
				Replica Count&nbsp;
				<select id="replicaCountInput" disabled >
					<option>2</option>
				</select>
			</span>
			
			<br>
			Additional Protocols:
			<span id="protocols" >
			NFS
			<label class="switch protocols" >
				<input id="nfsRequired" type="checkbox" class="switch-input" >
				<span class="switch-label" data-on="On" data-off="Off"></span>
				<span class="switch-handle"></span>
			</label>
			</span>
			
			<span id="protocols">
			&nbsp;&nbsp;CIFS
			<label class="switch protocols" >
				<input id="cifsRequired" type="checkbox" class="switch-input">
				<span class="switch-label" data-on="On" data-off="Off"></span>
				<span class="switch-handle"></span>
			</label>
			</span>
		</p>
		<span style="position:relative; top:-25px;">
		Available Bricks<br>
		<select id="brickPool" class="brickPool" multiple >
		</select>
		</span>
		<button id="useBrick" class="useBrick" onclick="useBrick()" ><i class="icon-right-big"></i></button>
		
		<!-- two tables are used - one for headers, the other for data. This allows the 
			table rows to be scrolled leaving the table headings in place. -->
			
		<table id="brickHeaders" cellspacing="0">
			<thead>
				<tr>
					<th >Bricks</th>
					<th >&nbsp;</th>					
				</tr>
			</thead>
		</table>
		
		<div id="brickLayout">
			<table id="brickTable" cellspacing="0" >
				<tbody>
					<tr>
						<td>
						</td>
						<td><button class="delbtn" onclick='delBrickRow(this)'><i class="icon-cancel"></i></button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<table id="configSummary" cellspacing="0">
			<thead style="height:20;">
				<tr >
					<th style="width:165px;">Volume Summary</th>
					<th style="width:60px;"># Bricks</th>
					<th style="width:60px;">Raw</th>
					<th style="width:60px;">Usable</th>
					<th style="width:120px;">Fault Tolerance</th>
					<th style="width:85px;">&nbsp;</th>
				</tr>
			</thead>
			<tbody>
				<tr style="height:30px;">
					<td></td>
					<td>0</td>
					<td>0</td>
					<td>0</td>
					<td>None</td>
					<td>
						<button id="volCreateBtn" class="createBtn" onclick="createVolume()"><i class="icon-commit-config"></i>Create</button>
					</td>
				</tr>
			</tbody>
		</table>

	</div>	
	<div id="finish"><h2>Finish</h2>
		<p>Initial configuration is now complete.
		<ul>
			<li class="tick">Cluster created	</li>
			<li class="tick">Disks discovered</li>
			<li class="tick">Bricks formated and mounted</li>
			<li class="tick">Volume created and optimised</li>
		</ul>
		</p>
		<p>At this point the initial configuration steps are complete.</p>
		<p>For examples of how to mount the volume click <a id="mountHelp" href="javascript:showMountHelp();">here</a>, or
		click on the button below to quit the installer.</p>
		<button id="quitButton" type="button" onclick='finish();' class="nextButton">Quit</button>
		<p>
			<span id="goodbye">This browser window/tab may now be closed.</span>
		</p>
	</div>	
		
	<div id="error"><h2>It's all gone wrong!</h2>
		<p>
		Sorry, it looks like a 'bad' thing just happened, so the setup can not continue.
		</p>
		<div style="position:relative; margin: 0 auto; width:330px; height:230px; border-radius:8px;background:white; border-color:#909090;box-shadow: 5px 5px 5px #888888;">
			<img style="display:block; margin: auto auto;" src="images/computer-error.jpg"></img>
		</div><br>
		<span style="position:relative;  color:red; font-weight: bold; font-size:22px;">DON'T PANIC</span>
		<p>On the node that you started the gluster-deploy script, there is a log file called 'gluster-deploy.log'. 
		Take a look at this file to see if the error has been captured. If not, you can try rerunning gluster-deploy
		with logging set to debug to capture more verbose information during the setup steps.
		</p>	
	</div>

</div>
</body>

</html>
